generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

model User {
  uuid                 String           @id @default(uuid())
  createdAt            DateTime         @default(now())
  email                String           @unique
  name                 String
  password             String
  confirmationCodeHash String?          @unique
  resetPasswordToken   String?          @unique
  defaultCurrency      Currency         @default(USD)
  introductionStep     IntroductionStep @default(DefaultCurrency)
  sessions             Session[]
  cashAccounts         CashAccount[]
  portfolios           Portfolio[]
}

model Session {
  name      String
  rtHash    String   @unique
  updatedAt DateTime @default(now())
  User      User     @relation(fields: [userUuid], references: [uuid])
  userUuid  String
}

model CashAccount {
  uuid     String               @id @default(uuid())
  name     String
  balance  Float                @default(0)
  currency Currency
  user     User                 @relation(fields: [userUuid], references: [uuid])
  userUuid String
  history  CashAccountHistory[] @relation()

  @@unique([userUuid, uuid])
}

model CashAccountHistory {
  uuid            String      @id @default(uuid())
  cashAccount     CashAccount @relation(fields: [cashAccountUuid], references: [uuid])
  cashAccountUuid String
  date            DateTime
  balance         Float
}

model Portfolio {
  uuid        String       @id @default(uuid())
  name        String
  instruments Instrument[]
  user        User         @relation(fields: [userUuid], references: [uuid])
  userUuid    String

  @@unique([userUuid, uuid])
}

model Instrument {
  uuid                  String         @id @default(uuid())
  name                  String
  percentageOfPortfolio Int?           @default(0)
  type                  InstrumentType
  portfolio             Portfolio      @relation(fields: [portfolioUuid], references: [uuid])
  portfolioUuid         String

  @@unique([portfolioUuid, uuid])
}

enum InstrumentType {
  stocks
  bonds
  commodies
  crypto
  immovables
  movables
  deposits
}

enum Currency {
  CHF
  EUR
  GBP
  USD
  PLN
}

enum IntroductionStep {
  DefaultCurrency
  CashAccounts
  Portfolios
  Completed
}
