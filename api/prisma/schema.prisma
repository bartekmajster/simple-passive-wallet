generator client {
  provider = "prisma-client-js"
}

generator nestgraphql {
  provider = "node node_modules/prisma-nestjs-graphql"
  output   = "../src/@generated"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

model User {
  uuid         String        @id @default(uuid())
  createdAt    DateTime      @default(now())
  email        String        @unique
  name         String
  password     String
  rtHash       String?
  cashAccounts CashAccount[]
  portfolios   Portfolio[]
}

model CashAccount {
  uuid     String   @id @default(uuid())
  name     String
  balance  Float    @default(0)
  currency Currency
  user     User     @relation(fields: [userUuid], references: [uuid])
  userUuid String

  @@unique([userUuid, uuid])
}

model Portfolio {
  uuid               String       @id @default(uuid())
  name               String
  rebalancingEnabled Boolean      @default(false)
  instruments        Instrument[]
  user               User         @relation(fields: [userUuid], references: [uuid])
  userUuid           String

  @@unique([userUuid, uuid])
}

model Instrument {
  uuid                  String         @id @default(uuid())
  name                  String
  percentageOfPortfolio Int?           @default(0)
  type                  InstrumentType
  portfolio             Portfolio      @relation(fields: [portfolioUuid], references: [uuid])
  portfolioUuid         String

  @@unique([portfolioUuid, uuid])
}

enum InstrumentType {
  stocks
  bonds
  commodies
  crypto
  immovables
  movables
  deposits
}

enum Currency {
  CHF
  EUR
  GBP
  USD
  PLN
}
