import{r as q,c as H,s as F,a as k,b as n,j as e,I as p,d as v,e as a,B as D,L as N,f as I,R as w,H as G,T as g,g as L,h as j,i as M}from"./index.dd455b61.js";import{u as W,L as B}from"./LangSelector.3832af16.js";import{F as z}from"./FullscreenClear.99a7d441.js";import{c as U,a as l,u as V,o as K,b as h}from"./array.a5e78e3f.js";import{u as $,S as J}from"./useStateMachine.9f14608d.js";import{u as S,c as Q}from"./checkEmail.4c4fc1e2.js";import{u as f}from"./useTranslation.6502199e.js";import{T as X}from"./Trans.dd365b18.js";const Y=q(({userEmail:s,userPassword:c})=>H.post("/auth/local/signin",{email:s,password:c}),{maxAttempts:3}),Z=s=>U().shape({userEmail:l().email("page.signin.email.invalid").required("page.signin.email.required"),userPassword:l().when("userEmail",{is:()=>s,then:l().required("page.signin.password.required")})}),ee=F.form.withConfig({displayName:"Form",componentId:"sc-pxj04b-0"})(["display:flex;flex-direction:column;"]),se=new J("email",{email:"email",password:"password"},{CHANGE_TO_PASSWORD:"CHANGE_TO_PASSWORD"},{email:{CHANGE_TO_PASSWORD:"password"}}),ae=()=>{const{t:s}=f(),c=k(),b=W(),{states:t,actions:x,updateState:y,compareState:i}=$(se),A={userEmail:"",userPassword:""},{register:m,handleSubmit:E,formState:{errors:u,isSubmitting:r},setError:d}=V({defaultValues:A,resolver:K(Z(i(t.password)))}),{request:P}=S(Q,{successCallback:({data:o})=>{o.exist?y(x.CHANGE_TO_PASSWORD):d("userEmail",{type:"custom",message:s("page.signin.account.does_not_exist")})}}),{request:T}=S(Y,{successCallback:async()=>{await b(I()),c(w.DASHBOARD.HOME)},failureCallback:o=>{d("userPassword",{type:"custom",message:o.message})}}),_=async({userEmail:o,userPassword:R})=>{i(t.email)&&await P({userEmail:o}),i(t.password)&&await T({userEmail:o,userPassword:R})},C=h({register:m,name:"userEmail",errors:u}),O=h({register:m,name:"userPassword",errors:u});return n(ee,{onSubmit:E(_),noValidate:!0,children:[e(p,{placeholder:s("common.email"),type:"email",disabled:i(t.password),"data-testid":"email-input",...C}),i(t.password)&&n(v.exports.Fragment,{children:[e(a,{}),e(p,{placeholder:s("common.password"),type:"password",autoFocus:!0,"data-testid":"password-input",...O})]}),e(a,{}),n(D,{width:"auto",disabled:r,type:"submit","data-testid":"submit-button",children:[r&&e(N,{color:"white","data-testid":"button-loader"}),!r&&i(t.email)&&s("common.next"),!r&&i(t.password)&&s("common.sign_in")]})]})},ue=()=>{const{t:s}=f();return n(z,{children:[e(G,{textAlign:"center",children:s("common.sign_in")}),e(a,{space:"small"}),e(g,{fontSize:"0.875",fontColor:"gray400",textAlign:"center",children:s("page.signin.description")}),e(a,{space:"large"}),e(ae,{}),e(a,{}),e(g,{fontSize:"0.875",fontColor:"gray400",textAlign:"center",children:e(X,{i18nKey:"page.signin.dont_have_account",components:{signup:e(L,{to:w.SIGNUP,fontColor:"blue"})}})}),e(a,{space:"large"}),e(a,{space:"large"}),e(a,{space:"large"}),n(j.exports.Column,{alignItems:"center",children:[e(B,{}),e(a,{}),e(M,{})]})]})};export{ue as Signin};
