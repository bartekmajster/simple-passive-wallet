import{r as q,c as H,s as k,u as w,a as F,b as v,d as o,j as e,I as p,e as D,S as a,B as N,L as I,f as G,R as f,H as j,T as g,g as L,h as M,i as W,k as B}from"./index.cb11aff0.js";import{F as z}from"./FullscreenClear.10435a7f.js";import{c as U,a as l,u as V,o as K,b as h}from"./array.bea738c1.js";import{u as $,S as J}from"./useStateMachine.f31aa605.js";import{u as S,c as Q}from"./checkEmail.bf864f99.js";import{T as X}from"./Trans.b2f228f0.js";const Y=q(({userEmail:s,userPassword:c})=>H.post("/auth/local/signin",{email:s,password:c}),{maxAttempts:3}),Z=s=>U().shape({userEmail:l().email("page.signin.email.invalid").required("page.signin.email.required"),userPassword:l().when("userEmail",{is:()=>s,then:l().required("page.signin.password.required")})}),ee=k.form.withConfig({displayName:"Form",componentId:"sc-pxj04b-0"})(["display:flex;flex-direction:column;"]),se=new J("email",{email:"email",password:"password"},{CHANGE_TO_PASSWORD:"CHANGE_TO_PASSWORD"},{email:{CHANGE_TO_PASSWORD:"password"}}),ae=()=>{const{t:s}=w(),c=F(),b=v(),{states:t,actions:x,updateState:y,compareState:i}=$(se),A={userEmail:"",userPassword:""},{register:m,handleSubmit:E,formState:{errors:u,isSubmitting:r},setError:d}=V({defaultValues:A,resolver:K(Z(i(t.password)))}),{request:P}=S(Q,{successCallback:({data:n})=>{n.exist?y(x.CHANGE_TO_PASSWORD):d("userEmail",{type:"custom",message:s("page.signin.account.does_not_exist")})}}),{request:T}=S(Y,{successCallback:async()=>{await b(G()),c(f.DASHBOARD.HOME)},failureCallback:n=>{d("userPassword",{type:"custom",message:n.message})}}),_=async({userEmail:n,userPassword:R})=>{i(t.email)&&await P({userEmail:n}),i(t.password)&&await T({userEmail:n,userPassword:R})},C=h({register:m,name:"userEmail",errors:u}),O=h({register:m,name:"userPassword",errors:u});return o(ee,{onSubmit:E(_),noValidate:!0,children:[e(p,{placeholder:s("common.email"),type:"email",disabled:i(t.password),"data-testid":"email-input",...C}),i(t.password)&&o(D.exports.Fragment,{children:[e(a,{}),e(p,{placeholder:s("common.password"),type:"password",autoFocus:!0,"data-testid":"password-input",...O})]}),e(a,{}),o(N,{width:"auto",disabled:r,type:"submit","data-testid":"submit-button",children:[r&&e(I,{color:"white","data-testid":"button-loader"}),!r&&i(t.email)&&s("common.next"),!r&&i(t.password)&&s("common.sign_in")]})]})},le=()=>{const{t:s}=w();return o(z,{children:[e(j,{textAlign:"center",children:s("common.sign_in")}),e(a,{space:"small"}),e(g,{fontSize:"0.875",fontColor:"gray400",textAlign:"center",children:s("page.signin.description")}),e(a,{space:"large"}),e(ae,{}),e(a,{}),e(g,{fontSize:"0.875",fontColor:"gray400",textAlign:"right",children:e(X,{i18nKey:"page.signin.dont_have_account",components:{signup:e(L,{to:f.SIGNUP,fontColor:"blue"})}})}),e(a,{space:"large"}),e(a,{space:"large"}),e(a,{space:"large"}),o(M.exports.Column,{alignItems:"center",children:[e(W,{}),e(a,{}),e(B,{})]})]})};export{le as Signin};
