import{r as q,c as O,u as l,d as i,e as _,j as e,I as u,S as r,s as k,b as v,a as R,B as F,L as I,f as H,R as P,v as D,H as j,T as f,g as G,h as L,i as W,k as M}from"./index.cb11aff0.js";import{F as z}from"./FullscreenClear.10435a7f.js";import{b as p,c as B,a as t,d as U,u as V,o as $}from"./array.bea738c1.js";import{u as E,c as K}from"./checkEmail.bf864f99.js";import{u as J,S as Q}from"./useStateMachine.f31aa605.js";import{T as X}from"./Trans.b2f228f0.js";const Y=q(({userName:s,userEmail:a,userPassword:o})=>O.post("/auth/local/signup",{name:s,email:a,password:o}),{maxAttempts:3}),Z=({register:s,errors:a})=>{const{t:o}=l(),m=p({register:s,name:"userName",errors:a}),n=p({register:s,name:"userEmail",errors:a});return i(_.exports.Fragment,{children:[e(u,{placeholder:o("common.name"),type:"text",...m}),e(r,{}),e(u,{placeholder:o("common.email"),type:"text",...n})]})},ee=({register:s,errors:a})=>{const{t:o}=l(),m=p({register:s,name:"userPassword",errors:a}),n=p({register:s,name:"userPasswordConfirmation",errors:a});return i(_.exports.Fragment,{children:[e(u,{placeholder:o("common.password"),type:"password",autoFocus:!0,...m}),e(r,{}),e(u,{placeholder:o("page.signup.password.confirm"),type:"password",...n})]})},se=s=>B().shape({userName:t().min(4,"page.signup.name.too_short").max(50,"page.signup.name.too_long").required("page.signup.name.required"),userEmail:t().email("page.signin.email.invalid").required("page.signin.email.required"),userPassword:t().when(["userName","userEmail"],{is:()=>s,then:t().min(12,"page.signin.password.too_short").max(50,"page.signin.password.too_long").required("page.signin.password.required")}),userPasswordConfirmation:t().when(["userName","userEmail"],{is:()=>s,then:t().required("page.signup.password.confirm.required").oneOf([U("userPassword")],"page.signup.password.do_not_match")})}),ae=k.form.withConfig({displayName:"Form",componentId:"sc-jub5wj-0"})(["display:flex;flex-direction:column;"]),ne=new Q("nameAndEmail",{nameAndEmail:"nameAndEmail",passwords:"passwords"},{CHANGE_TO_PASSWORDS:"CHANGE_TO_PASSWORDS"},{nameAndEmail:{CHANGE_TO_PASSWORDS:"passwords"}}),re=()=>{const{t:s}=l(),{states:a,actions:o,updateState:m,compareState:n}=J(ne),y=v(),A=R(),x={userName:"",userEmail:"",userPassword:"",userPasswordConfirmation:""},{register:h,handleSubmit:C,formState:{errors:w,isSubmitting:c},setError:d}=V({defaultValues:x,resolver:$(se(n(a.passwords)))}),{request:N}=E(K,{successCallback:({data:g})=>{g.exist?d("userEmail",{type:"custom",message:s("page.signup.email.already_in_use")}):m(o.CHANGE_TO_PASSWORDS)}}),{request:T}=E(Y,{successCallback:async()=>{await y(H()),A(P.INTRODUCTION)},failureCallback:()=>{d("userPassword",{type:"custom",message:s("service.unknown_error")}),d("userPasswordConfirmation",{type:"custom",message:""})}});return i(ae,{onSubmit:C(async({userName:g,userEmail:S,userPassword:b})=>{if(n(a.nameAndEmail)&&N({userEmail:S}),n(a.passwords))try{await T({userName:g,userEmail:S,userPassword:b})}catch{D(s("service.unknown_error"))}}),noValidate:!0,children:[n(a.nameAndEmail)&&e(Z,{register:h,errors:w}),n(a.passwords)&&e(ee,{register:h,errors:w}),e(r,{}),i(F,{width:"auto",disabled:c,type:"submit",children:[c&&e(I,{color:"white"}),!c&&n(a.nameAndEmail)&&s("common.next"),!c&&n(a.passwords)&&s("common.sign_up")]})]})},le=()=>{const{t:s}=l();return i(z,{children:[e(j,{textAlign:"center",children:s("common.sign_up")}),e(r,{space:"small"}),e(f,{fontSize:"0.875",fontColor:"gray400",textAlign:"center",children:s("page.signup.description")}),e(r,{space:"large"}),e(re,{}),e(r,{}),e(f,{fontSize:"0.875",fontColor:"gray400",textAlign:"right",children:e(X,{i18nKey:"page.signup.already_have_account",components:{signin:e(G,{to:P.SIGNIN,fontColor:"blue"})}})}),e(r,{space:"large"}),e(r,{space:"large"}),e(r,{space:"large"}),i(L.exports.Column,{alignItems:"center",children:[e(W,{}),e(r,{}),e(M,{})]})]})};export{le as Signup};
