import{r as I,c as G,s as L,a as m,b as j,d as n,j as e,e as M,I as h,f as a,B as W,L as B,g as V,R as b,H as z,T as S,h as U,i as K,k as $}from"./index.c4ac14b0.js";import{u as J,L as Q}from"./LangSelector.8465320f.js";import{F as X}from"./FullscreenClear.0d191a4f.js";import{c as Y,a as u,u as Z,o as ee,b as f}from"./array.b9b12b7b.js";import{u as se,S as ae}from"./useStateMachine.6e68ce09.js";import{u as w,c as te}from"./checkEmail.e9cc601c.js";import{u as x}from"./useTranslation.d539c65d.js";import{T as oe}from"./Trans.dcd090ac.js";const ie=I(({userEmail:s,userPassword:r,token:c})=>G.post("/auth/local/signin",{email:s,password:r,token:c}),{maxAttempts:3}),ne=s=>Y().shape({userEmail:u().email("page.signin.email.invalid").required("page.signin.email.required"),userPassword:u().when("userEmail",{is:()=>s,then:u().required("page.signin.password.required")})}),re=L.form.withConfig({displayName:"Form",componentId:"sc-pxj04b-0"})(["display:flex;flex-direction:column;"]),ce=new ae("email",{email:"email",password:"password"},{CHANGE_TO_PASSWORD:"CHANGE_TO_PASSWORD"},{email:{CHANGE_TO_PASSWORD:"password"}}),le=()=>{const{t:s}=x(),[r,c]=m.exports.useState(""),[C,y]=m.exports.useState(!1),T=j(),A=J(),{states:t,actions:E,updateState:P,compareState:o}=se(ce),_={userEmail:"",userPassword:""},{register:p,handleSubmit:R,formState:{errors:d,isSubmitting:l},setError:g}=Z({defaultValues:_,resolver:ee(ne(o(t.password)))}),{request:k}=w(te,{successCallback:({data:i})=>{i.exist?P(E.CHANGE_TO_PASSWORD):g("userEmail",{type:"custom",message:s("page.signin.account.does_not_exist")})}}),{request:O}=w(ie,{successCallback:async()=>{await A(V()),T(b.DASHBOARD.HOME)},failureCallback:i=>{g("userPassword",{type:"custom",message:i.message})}}),q=m.exports.useCallback(c,[c]),H=async({userEmail:i,userPassword:D})=>{o(t.email)&&await k({userEmail:i,token:r}),o(t.password)&&await O({userEmail:i,userPassword:D,token:r}),y(N=>!N)},F=f({register:p,name:"userEmail",errors:d}),v=f({register:p,name:"userPassword",errors:d});return n(re,{onSubmit:R(H),noValidate:!0,children:[e(M,{onVerify:q,refreshReCaptcha:C}),e(h,{placeholder:s("common.email"),type:"email",disabled:o(t.password),"data-testid":"email-input",...F}),o(t.password)&&n(m.exports.Fragment,{children:[e(a,{}),e(h,{placeholder:s("common.password"),type:"password",autoFocus:!0,"data-testid":"password-input",...v})]}),e(a,{}),n(W,{width:"auto",disabled:l,type:"submit","data-testid":"submit-button",children:[l&&e(B,{color:"white","data-testid":"button-loader"}),!l&&o(t.email)&&s("common.next"),!l&&o(t.password)&&s("common.sign_in")]})]})},we=()=>{const{t:s}=x();return n(X,{children:[e(z,{textAlign:"center",children:s("common.sign_in")}),e(a,{space:"small"}),e(S,{fontSize:"0.875",fontColor:"gray400",textAlign:"center",children:s("page.signin.description")}),e(a,{space:"large"}),e(le,{}),e(a,{}),e(S,{fontSize:"0.875",fontColor:"gray400",textAlign:"center",children:e(oe,{i18nKey:"page.signin.dont_have_account",components:{signup:e(U,{to:b.SIGNUP,fontColor:"blue"})}})}),e(a,{space:"large"}),e(a,{space:"large"}),e(a,{space:"large"}),n(K.exports.Column,{alignItems:"center",children:[e(Q,{}),e(a,{}),e($,{})]})]})};export{we as Signin};
